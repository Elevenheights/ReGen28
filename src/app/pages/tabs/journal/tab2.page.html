<ion-content class="bg-[#F3E8FF]" style="--background: #F3E8FF !important;" [fullscreen]="true">
	<ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
		<ion-refresher-content></ion-refresher-content>
	</ion-refresher>

	<!-- Header: My Journal -->
	<app-page-header title="My Journal" subtitle="Reflect & Grow" theme="purple" actionIcon="fa-pen-nib"
		(actionClick)="onWriteNewEntry()">

		<!-- Journal Stats (Projected) -->
		<div class="animate-entry delay-300">
			<!-- Journey Snapshot -->
			<div class="flex items-center justify-between mb-8 text-white">
				<div class="flex items-center space-x-3">
					<div
						class="w-12 h-12 bg-white/10 backdrop-blur-md rounded-2xl flex items-center justify-center border border-white/20 shadow-inner">
						<i class="fa-solid fa-book-open text-white text-lg"></i>
					</div>
					<div>
						<h3 class="text-[10px] font-black text-white/60 uppercase tracking-widest leading-none mb-1.5">
							Your Journal Journey</h3>
						<p class="text-sm font-bold text-white">{{ getJourneySubtext() }}</p>
					</div>
				</div>
				<div class="text-right" (click)="onStatClick('total')">
					<div class="text-3xl font-black text-white tracking-tighter cursor-pointer leading-none"
						[appCountUp]="journalStats?.totalEntries || 0"></div>
					<div class="text-[9px] uppercase tracking-widest font-bold text-white/50 mt-1">Reflections</div>
				</div>
			</div>

			<!-- Stats Grid -->
			<div class="grid grid-cols-3 gap-3">
				<div (click)="onStatClick('week')"
					class="bg-white/10 backdrop-blur-md rounded-3xl p-4 text-center border border-white/10 shadow-lg cursor-pointer active:scale-95 transition-all">
					<div class="text-xl font-black text-white mb-0.5 leading-none"
						[appCountUp]="journalStats?.weeklyCount || 0">
					</div>
					<div class="text-[9px] uppercase tracking-wider font-bold text-white/50">Week</div>
				</div>
				<div (click)="onStatClick('streak')"
					class="bg-white/10 backdrop-blur-md rounded-3xl p-4 text-center border border-white/10 shadow-lg cursor-pointer active:scale-95 transition-all">
					<div class="text-xl font-black text-amber-300 mb-0.5 leading-none"
						[appCountUp]="journalStats?.currentStreak || 0"></div>
					<div class="text-[9px] uppercase tracking-wider font-bold text-white/50">Streak</div>
				</div>
				<div (click)="onStatClick('mood')"
					class="bg-white/10 backdrop-blur-md rounded-3xl p-4 text-center border border-white/10 shadow-lg cursor-pointer active:scale-95 transition-all">
					<div class="text-xl font-bold text-white mb-0.5 leading-none">{{
						getMoodEmoji(journalStats?.averageMood) }}</div>
					<div class="text-[9px] uppercase tracking-wider font-bold text-white/50">Mood</div>
				</div>
			</div>
		</div>
	</app-page-header>

	<!-- Skeleton Loader for Journal -->
	<div *ngIf="isLoading" class="px-5 pt-4 pb-24 space-y-8 animate-entry">
		<!-- Header Snapshot Skeleton -->
		<div class="space-y-8 mb-12">
			<div class="flex items-center justify-between">
				<div class="flex items-center space-x-3">
					<div class="w-12 h-12 bg-white/10 rounded-2xl animate-pulse"></div>
					<div class="space-y-2">
						<div class="w-24 h-2 bg-white/10 rounded-full animate-pulse"></div>
						<div class="w-32 h-3 bg-white/10 rounded-full animate-pulse"></div>
					</div>
				</div>
				<div class="w-16 h-10 bg-white/10 rounded-2xl animate-pulse"></div>
			</div>
			<div class="grid grid-cols-3 gap-3">
				<div class="h-20 bg-white/10 rounded-3xl animate-pulse" *ngFor="let i of [1,2,3]"></div>
			</div>
		</div>

		<!-- Inspiration Card Skeleton -->
		<div class="h-56 bg-white rounded-[2.5rem] animate-pulse shadow-sm"></div>

		<!-- Memory Library Skeleton -->
		<div class="space-y-4">
			<div class="flex justify-between items-center px-1">
				<div class="w-32 h-3 bg-neutral-200/50 rounded-full animate-pulse"></div>
				<div class="w-16 h-3 bg-neutral-200/50 rounded-full animate-pulse"></div>
			</div>
			<div class="grid grid-cols-2 gap-4">
				<div class="h-44 bg-white rounded-[2.2rem] animate-pulse shadow-sm" *ngFor="let i of [1,2,3,4]"></div>
			</div>
		</div>
	</div>

	<!-- Memory Board -->
	<div *ngIf="!isLoading" class="px-5 -mt-6 relative z-20 pb-24 space-y-8">

		<!-- 1. Featured Inspiration Card -->
		<div *ngIf="dailyPrompt" (click)="onPromptSelected(dailyPrompt)"
			class="bg-white rounded-[2.5rem] p-7 shadow-xl shadow-purple-200/40 border border-white relative overflow-hidden group active:scale-[0.98] transition-all animate-entry delay-500">
			<!-- Glow -->
			<div
				class="absolute -top-12 -right-12 w-32 h-32 bg-amber-100/50 rounded-full blur-2xl group-hover:bg-amber-200/50 transition-colors">
			</div>

			<div class="relative z-10">
				<div class="flex items-center gap-3 mb-4">
					<div
						class="w-8 h-8 rounded-xl bg-amber-50 flex items-center justify-center text-amber-600 shadow-sm">
						<i class="fa-solid fa-wand-magic-sparkles text-xs"></i>
					</div>
					<span class="text-[10px] font-black text-amber-600 uppercase tracking-widest">Daily Soul
						Prompt</span>
				</div>

				<h2 class="text-lg font-bold text-neutral-900 leading-tight italic font-serif mb-6">"{{ dailyPrompt.text
					}}"</h2>

				<div class="flex items-center justify-between">
					<div class="text-[10px] font-black text-neutral-400 uppercase tracking-widest">Tap to reflect</div>
					<div
						class="w-10 h-10 rounded-2xl bg-neutral-900 text-white flex items-center justify-center shadow-lg group-hover:translate-x-1 transition-transform">
						<i class="fa-solid fa-arrow-right text-xs"></i>
					</div>
				</div>
			</div>
		</div>

		<!-- 2. Recent Entries -->
		<div class="space-y-4 animate-entry delay-500">
			<div class="flex items-center justify-between px-1">
				<h3 class="text-xs font-black text-neutral-400 uppercase tracking-widest">Memory Library</h3>
				<button
					class="text-[10px] font-black text-purple-600 uppercase tracking-widest hover:translate-x-1 transition-transform"
					(click)="onViewAllEntries()">
					Expand All
				</button>
			</div>

			<div class="grid grid-cols-2 gap-4">
				<div *ngFor="let entry of recentEntries; let i = index"
					class="bg-white rounded-[2rem] p-5 shadow-sm hover:shadow-xl transition-all border border-neutral-100/50 flex flex-col justify-between group active:scale-95"
					(click)="onEntryClick(entry)">
					<div class="space-y-4">
						<div class="flex justify-between items-start">
							<div class="flex flex-col">
								<span class="text-[10px] font-black text-neutral-900 leading-none">{{ entry.date |
									date:'d' }}</span>
								<span class="text-[8px] font-bold text-neutral-400 uppercase tracking-widest">{{
									entry.date | date:'MMM' }}</span>
							</div>
							<span class="text-xl filter drop-shadow-sm group-hover:scale-125 transition-transform">{{
								getMoodEmoji(entry.mood) }}</span>
						</div>
						<h4
							class="font-black text-neutral-900 text-xs leading-snug line-clamp-2 uppercase tracking-tight">
							{{ entry.title || 'Untitled' }}</h4>
					</div>

					<div class="mt-4 pt-4 border-t border-neutral-50 flex justify-between items-center">
						<span *ngFor="let tag of entry.tags?.slice(0, 1)"
							class="text-[9px] font-black text-purple-400 uppercase">#{{tag}}</span>
						<i class="fa-solid fa-chevron-right text-[8px] text-neutral-200"></i>
					</div>
				</div>

				<!-- Empty State -->
				<div class="col-span-2" *ngIf="recentEntries.length === 0">
					<div
						class="text-center py-16 px-8 bg-white/50 rounded-[2.5rem] border-2 border-dashed border-purple-100 flex flex-col items-center">
						<div
							class="w-20 h-20 bg-purple-50 rounded-3xl flex items-center justify-center mb-6 shadow-inner">
							<i class="fa-solid fa-feather-pointed text-purple-200 text-3xl"></i>
						</div>
						<p class="text-[11px] font-black text-neutral-400 uppercase tracking-widest">Your story awaits
							its first word</p>
						<button (click)="onWriteNewEntry()"
							class="mt-6 text-xs font-black text-purple-600 uppercase tracking-widest hover:underline decoration-2 underline-offset-4">Reflect
							Now</button>
					</div>
				</div>
			</div>
		</div>

		<!-- 3. Explore Prompts (Mini Cards) -->
		<div class="pb-6">
			<div class="flex items-center justify-between px-2 mb-3">
				<h3 class="text-xs font-black text-neutral-400 uppercase tracking-widest">Explore</h3>
				<button (click)="onRefreshPrompts()"
					class="w-8 h-8 rounded-full bg-white border border-neutral-100 flex items-center justify-center shadow-sm text-neutral-400">
					<i class="fa-solid fa-rotate text-[10px]"></i>
				</button>
			</div>

			<div class="flex space-x-3 overflow-x-auto pb-4 scrollbar-hide px-1">
				<div *ngFor="let prompt of journalPrompts" (click)="onPromptSelected(prompt)"
					class="min-w-[160px] bg-white rounded-2xl p-4 shadow-sm border border-neutral-50 active:scale-95 transition-transform">
					<div
						class="w-8 h-8 rounded-full bg-orange-50 text-orange-400 flex items-center justify-center mb-3">
						<i class="fa-solid fa-lightbulb text-xs"></i>
					</div>
					<p
						class="text-[10px] font-black text-neutral-800 line-clamp-3 leading-relaxed uppercase tracking-tight">
						{{ prompt.text }}</p>
				</div>
			</div>
		</div>
	</div>
</ion-content>

<style>
	.scrollbar-hide::-webkit-scrollbar {
		display: none;
	}

	.font-serif {
		font-family: 'Georgia', serif;
		/* Only used heavily in the quote card */
	}
</style>