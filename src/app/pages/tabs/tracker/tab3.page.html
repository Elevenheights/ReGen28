<ion-content class="bg-neutral-50" [fullscreen]="true">
	<!-- Pull to refresh -->
	<ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
		<ion-refresher-content></ion-refresher-content>
	</ion-refresher>

	<!-- Loading state (Skeletons) -->
	<div *ngIf="isLoading" class="pb-24 px-6 pt-4 animate-entry">
		<!-- Header Skeleton Area -->
		<div class="mb-8">
			<div class="w-24 h-4 bg-neutral-200 rounded-full animate-pulse mb-2"></div>
			<div class="w-48 h-8 bg-neutral-200 rounded-full animate-pulse mb-6"></div>
			<div
				class="bg-neutral-200/50 backdrop-blur-xl rounded-[2.5rem] h-40 w-full p-6 border border-neutral-100 animate-pulse">
				<div class="flex justify-between mb-6">
					<div class="w-24 h-2 bg-neutral-200 rounded-full"></div>
					<div class="w-12 h-4 bg-neutral-200 rounded-full"></div>
				</div>
				<div class="w-full h-2.5 bg-neutral-200 rounded-full"></div>
			</div>
		</div>

		<!-- Performance Stats Skeleton -->
		<div class="grid grid-cols-2 gap-3 mb-10 -mt-2">
			<div class="h-28 bg-neutral-100/50 rounded-3xl animate-pulse shadow-sm" *ngFor="let i of [1,2]"></div>
		</div>

		<!-- Groups Skeleton -->
		<div class="space-y-12">
			<div *ngFor="let i of [1,2]" class="space-y-6">
				<div class="flex items-center space-x-4">
					<div class="w-12 h-12 bg-neutral-100 rounded-2xl animate-pulse"></div>
					<div class="space-y-2">
						<div class="w-24 h-5 bg-neutral-100 rounded-full animate-pulse"></div>
						<div class="w-32 h-2.5 bg-neutral-100 rounded-full animate-pulse opacity-50"></div>
					</div>
				</div>
				<div class="space-y-4">
					<div class="h-36 bg-white rounded-[2rem] border border-neutral-100 shadow-sm animate-pulse"
						*ngFor="let j of [1,2]"></div>
				</div>
			</div>
		</div>
	</div>

	<!-- Main Content -->
	<main *ngIf="!isLoading" class="relative z-10 pb-32">
		<!-- 1. Activities Header -->
		<app-page-header title="Activities" subtitle="Life in Alignment" theme="indigo" actionIcon="fa-plus"
			(actionClick)="openQuickLogModal()">

			<!-- Today's Flow Progress (Projected) -->
			<div class="bg-white/5 backdrop-blur-xl rounded-[2.5rem] p-6 border border-white/10 shadow-2xl">
				<div class="flex items-center justify-between mb-4">
					<div class="flex items-center gap-2">
						<div class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></div>
						<span class="text-[10px] font-black text-white/60 uppercase tracking-[0.3em]">Today's
							Aura</span>
					</div>
					<span class="text-sm font-black text-white tracking-tighter"><span
							[appCountUp]="dailyProgress"></span>%</span>
				</div>
				<div class="h-2.5 bg-white/5 rounded-full overflow-hidden p-0.5 border border-white/5">
					<div class="h-full bg-gradient-to-r from-emerald-400 via-blue-400 to-indigo-400 rounded-full transition-all duration-1000 ease-out shadow-[0_0_15px_rgba(52,211,153,0.3)]"
						[style.width.%]="dailyProgress">
					</div>
				</div>
			</div>
		</app-page-header>

		<!-- 2. Performance Stats -->
		<div class="px-6 -mt-4 relative z-20 animate-entry delay-100">
			<app-tracker-stats></app-tracker-stats>
		</div>

		<!-- 3. Activities List (Grouped) -->
		<div class="px-6 mt-8 space-y-12">

			<!-- Dynamic Groups -->
			<div *ngFor="let group of groupedTrackers; let i = index" class="space-y-6 animate-entry"
				[class.delay-200]="i === 0" [class.delay-300]="i === 1" [class.delay-500]="i > 1">

				<!-- Section Header -->
				<div class="flex items-center gap-4">
					<div class="w-12 h-12 rounded-2xl flex items-center justify-center shadow-sm"
						[class.bg-blue-50]="group.category === 'mind'" [class.text-blue-600]="group.category === 'mind'"
						[class.bg-emerald-50]="group.category === 'body'"
						[class.text-emerald-600]="group.category === 'body'"
						[class.bg-purple-50]="group.category === 'soul'"
						[class.text-purple-600]="group.category === 'soul'"
						[class.bg-pink-50]="group.category === 'beauty'"
						[class.text-pink-600]="group.category === 'beauty'"
						[class.bg-amber-50]="group.category === 'custom'"
						[class.text-amber-600]="group.category === 'custom'">
						<i class="fa-solid {{ getCategoryIconForGroup(group.category) }} text-xl"></i>
					</div>
					<div class="flex-1">
						<h2 class="text-xl font-black text-neutral-900 tracking-tight leading-none mb-1">{{
							group.category | titlecase }}</h2>
						<p class="text-[10px] text-neutral-400 font-bold uppercase tracking-widest">{{
							group.trackers.length }} Active Patterns</p>
					</div>
				</div>

				<!-- Group Items Grid -->
				<div class="grid grid-cols-1 gap-4">
					<app-tracker-card *ngFor="let tracker of group.trackers; trackBy: trackByTrackerId"
						[tracker]="tracker" (quickLog)="quickLog(tracker, 1)" (openLogModal)="openLogModal(tracker)"
						(openDetail)="navigateToTrackerDetail(tracker)">
					</app-tracker-card>
				</div>
			</div>

			<!-- Empty State -->
			<div *ngIf="activeTrackers.length === 0" class="py-16 text-center animate-entry">
				<div
					class="w-24 h-24 bg-neutral-100 rounded-[2.5rem] flex items-center justify-center mx-auto mb-8 shadow-inner">
					<i class="fa-solid fa-seedling text-4xl text-neutral-200"></i>
				</div>
				<h3 class="text-2xl font-black text-neutral-900 mb-3 tracking-tighter">Your field is empty</h3>
				<p class="text-xs text-neutral-400 max-w-xs mx-auto mb-10 font-bold uppercase tracking-widest">Plant
					your first habit pattern to begin</p>

				<div class="grid grid-cols-1 gap-5 max-w-sm mx-auto">
					<button (click)="navigateToAddTracker()"
						class="w-full p-6 bg-white rounded-[2rem] border border-neutral-100 shadow-sm flex items-center justify-between group active:scale-95 transition-all">
						<div class="flex items-center gap-4 text-left">
							<div
								class="w-12 h-12 rounded-2xl bg-indigo-50 flex items-center justify-center text-indigo-500 group-hover:bg-indigo-500 group-hover:text-white transition-all">
								<i class="fa-solid fa-shapes text-xl"></i>
							</div>
							<div>
								<p class="font-black text-neutral-900 uppercase tracking-tight text-sm">Sacred Templates
								</p>
								<p class="text-[10px] text-neutral-400 font-bold uppercase tracking-widest">Proven paths
								</p>
							</div>
						</div>
						<i
							class="fa-solid fa-chevron-right text-neutral-200 group-hover:translate-x-1 transition-transform"></i>
					</button>

					<button (click)="navigateToAddTracker()"
						class="w-full p-6 bg-white rounded-[2rem] border border-neutral-100 shadow-sm flex items-center justify-between group active:scale-95 transition-all">
						<div class="flex items-center gap-4 text-left">
							<div
								class="w-12 h-12 rounded-2xl bg-purple-50 flex items-center justify-center text-purple-500 group-hover:bg-purple-500 group-hover:text-white transition-all">
								<i class="fa-solid fa-magic-wand-sparkles text-xl"></i>
							</div>
							<div>
								<p class="font-black text-neutral-900 uppercase tracking-tight text-sm">Unique Rhythm
								</p>
								<p class="text-[10px] text-neutral-400 font-bold uppercase tracking-widest">Custom
									creation</p>
							</div>
						</div>
						<i
							class="fa-solid fa-chevron-right text-neutral-200 group-hover:translate-x-1 transition-transform"></i>
					</button>
				</div>
			</div>


			<!-- Premium Add Activity Button (Moved from FAB) -->
			<div class="pt-8 animate-entry delay-500">
				<div
					class="bg-gradient-to-br from-indigo-600 to-violet-600 p-px rounded-[2.5rem] shadow-xl shadow-indigo-500/10">
					<button (click)="onAddTracker()"
						class="w-full bg-neutral-900 rounded-[2.4rem] p-6 flex items-center justify-between active:scale-95 transition-all group overflow-hidden relative">
						<div
							class="absolute inset-0 bg-indigo-500/10 opacity-0 group-hover:opacity-100 transition-opacity">
						</div>
						<div class="flex items-center gap-5 relative z-10">
							<div
								class="w-12 h-12 bg-indigo-600 text-white rounded-2xl flex items-center justify-center shadow-lg transform group-hover:rotate-12 transition-transform">
								<i class="fa-solid fa-wand-magic-sparkles text-xl"></i>
							</div>
							<div class="text-left">
								<p class="font-black text-white uppercase tracking-tight">Add New Tracker</p>
								<p class="text-[10px] text-indigo-400 font-bold uppercase tracking-widest">Create a new
									rhythm to track</p>
							</div>
						</div>
						<i
							class="fa-solid fa-chevron-right text-white/30 group-hover:translate-x-1 transition-transform"></i>
					</button>
				</div>
			</div>

			<!-- Celebrated Completions -->
			<section *ngIf="completedTrackers.length > 0" class="animate-entry delay-500 pt-8">
				<div class="flex items-center justify-between mb-8 px-1">
					<div class="flex items-center gap-3">
						<div
							class="w-10 h-10 rounded-2xl bg-white border border-neutral-100 shadow-sm flex items-center justify-center text-amber-500">
							<i class="fa-solid fa-award text-lg"></i>
						</div>
						<div>
							<h2 class="text-xs font-black text-neutral-400 uppercase tracking-widest leading-none mb-1">
								Hall of Victory</h2>
							<p class="text-[10px] text-neutral-300 font-bold uppercase tracking-widest"><span
									[appCountUp]="completedTrackers.length"></span> Triumphs</p>
						</div>
					</div>
					<button
						class="text-[10px] font-black text-amber-600 uppercase tracking-widest hover:translate-x-1 transition-transform">Archive</button>
				</div>

				<div class="grid grid-cols-1 gap-5">
					<div *ngFor="let tracker of completedTrackers.slice(0, 3)"
						class="bg-white rounded-[2.5rem] p-6 border border-neutral-100 flex items-center justify-between shadow-sm relative overflow-hidden group active:scale-95 transition-all">

						<!-- Shine effect -->
						<div
							class="absolute inset-0 bg-gradient-to-r from-transparent via-amber-50/50 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000">
						</div>

						<div class="flex items-center gap-5 relative z-10">
							<div
								class="w-16 h-16 bg-neutral-50 rounded-[1.8rem] flex items-center justify-center shadow-inner transform group-hover:scale-110 transition-transform">
								<i [class]="'fa-solid ' + getTrackerIcon(tracker)"
									[style.color]="getTrackerColor(tracker)" class="text-3xl"></i>
							</div>
							<div class="text-left">
								<p class="text-lg font-black text-neutral-900 leading-none mb-2 tracking-tight">{{
									tracker.name }}</p>
								<div class="flex items-center gap-2">
									<div class="px-2 py-0.5 bg-amber-50 rounded-full border border-amber-100">
										<p class="text-[9px] font-black text-amber-600 uppercase tracking-widest">
											Mastery</p>
									</div>
									<span class="text-[8px] font-black text-neutral-300 uppercase tracking-widest">{{
										getCategoryLabel(tracker.category) }}</span>
								</div>
							</div>
						</div>
						<div
							class="w-10 h-10 rounded-2xl bg-amber-500 flex items-center justify-center text-white shadow-lg shadow-amber-200">
							<i class="fa-solid fa-check"></i>
						</div>
					</div>
				</div>
			</section>

		</div>

		<!-- Bottom Spacer -->
		<div class="h-32"></div>
	</main>
</ion-content>